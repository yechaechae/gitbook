## Data-driven prediction of battery cycle life before capacity degradation

리튬이온 배터리 수명을 예측하는 일은 nonlinear degradation with cycling, wide variability, controling for operating conditions 때문에 어렵다.

Bloom은 semi-empirical model (반 경험적 모델)로 power와 용량 손실을 예측했다.

degradation 메커니즘에 대한 지식말고 early-cycle data로 data-driven 모델을 개발

첫번째 100 cycle에서 예측이 안좋다

* 실험 환경
약 150 ~ 2300 cycle 에서 dataset 만듬, 온도 일정

Voltage, current, cell 
elastic net 알고리즘 사용, 마지막 모델은 linear combination 
feature : initial discharge capacity, charge time, cell can temperature

각 셀의 cycling 동안의 전기화학적 evolution을 측정하기 위해서 몇 feature들은 discharge voltage curve를 기반으로 계산 되었다.

voltage 범위는 모든 cycle마다 같다. capacity를 voltage의  function(기능)으로 여기고 

주기를 비교하기 위한 균일 한 기반을 유지하기 위해 용량을 용량의 함수로 전압이 아닌 전압의 함수로 간주합니다

3개의 다른 모델을 조사
1. Q100-10의 변화
2. 방전되는 동안 추가적인 후보 feature
3. 온도, 내부 저항과 같은 추가적인 data streams으로 부터의 feature
데이터는 오직 초기 100 cycle에서만 가져온다. 

훈련 데이터 (41 셀)는 모델 특징을 선택하고 계수 값을 설정하는 데 사용됩니다.
primary testing data(43cells)는 모델 성능을 측정하는데 사용되었다.
그런 다음 모델 개발 후 생성 된 2 차 테스트 데이터 세트 (40 개 셀)에서 모델을 평가합니다.
RMSE로 성능 평가



## Early prediction of battery lifetime via a machine learning based framework
학계에 두가지 방법 존재
1. 모델기반
2. 머신러닝

기존의 배터리 예측 연구는 비선형 배터리 용량 감소로 인해 초기 사이클에서 무시할 수있는 변화 때문에 안좋은 예측 결과를 보여주었다. 
이 연구에서는 배터리 수명 예측의 정확한 초기 cycle 예측을 위해서 세가지 모듈(feature extraction, feature selection, machine learning based prediction)을 포함하는 포괄적인 머신러닝 기반의 프레임워크를 사용하는 것이 제안되었다.

* 기존 연구(ML) :
    - Severson, discharge voltage, capacity curves에서 feature 뽑아서 elastic net 모델 사용
    - Zhang , discharge capacity, terminal voltage, discahrge curent, internal resistance 에서 얻은 feature를 Nueral Netrwor(NN) 사용
    - Xu, dicharge temperature, voltage curves에서 얻은 feature를 stacked denoising autoencoder를사용
    - Yang, voltage, capacity, temperature profiles에서 얻은 feature를 gradient boosting regression tree(GBRT)모델을 사용 하여 예측
앞서 언급한 연구들은 배터리 수명 or RUL을 ML모델의 direct output으로 간주했다. 그러나 대부분 ML 관련 연구들은 배터리 상태 지표(SOH, etc)를 측정한 다음, RUL을 추가적인 계산(ex, 성능저하모델을 실패 임게값으로 외삽하여)으로 에측했다. 
    - Li, partial incremental capacity curves에서 feature를 얻어 Gaussian process regression(GPR)모델에 적용하여 배터리 SOH 를 예측
    - Shu, partial charging voltage curves에서 식별된 feature를 얻어 a least squares support vector machine(SVM)모델에 적용
    - Yang, constant-current charging curve에서 4가지의 feature를 뽑아 향상된 GPR모델로 예측
    - Li, battery charging time, discharging time, discharge capacity를 feature로 사용, a gated recurrent unit-recurrent neural network(게이트 순환 단위 순환 신경망) 모델을 사용 
    - Wu, 충전 과정 동안 배터리 terminal voltages 을 샘플링 한 것을 feature로 사용해서 three-layer feed forward NN 모델 사용
    - Ma, 특정 window에서의 배터리 용량을 featrue로 사용, convolutional neural network와 long short-term memory(LSTM)가 합쳐진 hybrid neural network로 다음 window를 예측

 In these studies, the RULs were then predicted as the estimated SOH/cycle number/capacity reached the failure threshold.

이전 연구들은 약 25%의 축적된 과거 degradation(하락) 데이터들로 예측
 초기 사이클에서 배터리 수명을 예측하는게 효율적이다. -> challengeing -> battery 데이터가 nonlinear하고, 초기 사이클에서 degradation이 상당히 적다.

 MIT 데이터셋 사용
 **이 연구에서는 대부분 cell들이 capacity degradation의 어떤 사인도 보여주지 않는 첫번째 100 싸이클 degradation 데이터로 초기 사이클 배터리 수명 예측을 연구** 
 게다가 기존의 연구들은 아주 작은 트레이닝 데이터셋을 이용, feature도 작다.
이 연구에서는 총 42개의 feature가 제안되었다. 그러나 feature 공간이 커질수록 어떤 feature들은 필요없거나 무관할 수 있어 원하지 않게 오버피팅 될 수 있다.
그래서 이 연구에서는 최적의 lower-dimensional feature 집합을 찾기위해  4가지 메인스트림 feature selection 방법이 조사, 분석되었다.

ML이 다양한 유형의 예측을 하는데 유용

SVM은 small sample sized 문제에 적용 가능, NN은 훈련하는데 큰 수의 샘플을 요구한다.

이 연구에서는 6가지의 ML모델이 비교, 분석 되었다.

* 연구 방법
1. 첫 100 사이클에서 뽑아온 배터리 degrdation data를 기반으로 42개의 feature를 수동으로 뽑아서 charge-related, discharge-related, capacity-related, temperature-related, IR-related 로 그룹핑된 feature들을 반영
2. 오버피팅 위해서 PCA 적용
3. elastic net, GPR, SVM, random forest , GBRT, NN 적용

* 결과 
SVM이 가장 효율적이었다. 

* Charge-related features
Fig2(a) curve의 오르는 부분은 CC charging mode에 해당하고 납작한 섹션은 CV charging mode를 나타낸다. 사이클 수가 증가할수록 charging 커브는 왼쪽 위로 이동한다.
이 뜻은 CC모드의 지속기간 줄어들고 CV모드의 지속기간이 증가한다는 뜻이다. 이는 배터리 분극 현상으로 인한 것이며 배터리의 성능이 저하됨에 따라 악화됩니다.
이 패턴을 기반으로 feature 지정

* Discharge-related features
discharge related feature는 배터리 성능 저하 진단에 매우 효과적인 정보 제공하는 기하학적인 분석과 discharge voltage curves와 파생물의 요약 통계를 통해 뽑아졌다.
ex. 예를 들어, 방전 용량의 변화를 작은 전압 단계 내에서 전압의 변화로 미분하여 계산되는 증분 용량 (IC, Incremental capacity) 곡선은 노화 메커니즘 식별과 온라인 SOH 측정을 위한 강력한 지표이다.
Fig2(b) 일반적으로 사이클 수가 증가할수록 IC peak의 전압과 높이는 동시에 감소한다. 그 후 F5, F6는 사이클 10~100 사이의 IC peak의 전압과 높이의 변화를 정의한다.
또한 F7은 사이클 10과 100 사이의 IC 피크 커버 영역의 차이로 정의되며 IC 피크 영역의 적분의 변화로 계산됩니다.
Fig2(c) 사이클 수가 증가할 수록 discharge capacity(방전 용량)와 전압 커브의 커버 영역이 감소하는 경향이 있다. 
물리적 측면에서 QiðVÞ와 QjðVÞ 곡선 사이 영역의 적분은 사이클 i와 j 사이의 방전 에너지 소산을 나타냅니다.
그러므로 이런 데이터는 배터리 수명을 예측하는데 유익하므로 F15-20은 이와 관련된 데이터.
비슷하게 F8-F14도 방전 전압에 따른 방전 시간인 T(V) 커브의 사이클간 evolution에서 뽑아왔다. 
F9-F14는 통계 요약
방전 시간은 방전 용량과 선형 상관 관계가 있지만 F8-F14 기능은 F15-F20 기능을 기반으로 배터리 수명 예측을 위한 몇 가지 새로운 정보를 제공 할 수 있습니다. 여기에서는 다른 종류의 요약 통계가 원본 데이터에 대한 비선형 변환을 수행하는 데 사용되기 때문입니다.

* Capacity-related fatures
용량은 배터리 성능 저하의 직관적인 척도이다.
linear, square-root-of-time, CE 모델이 고려되어졌다.
    * linear model : 단순한 degradation(저하) 모델
    * square-root-of-time : 전형적인 반경험적 모델, 리튬 재고 손실을 고려하여 리튬 이온 배터리의 성능 저하를 모델링, 이는 SEI 필름의 두께 때문에 발생한다. 필름 두께는 Eq에 의해 주어진 시간의 제곱근에 비례합니다.
    * CE 모델 : CE와 배터리 성능 저하율 간의 관계를 포착하여 배터리 용량 저하를 모델링하는 반 경험적 모델

* Temperature-related features
온도는 배터리 노화 역학에 반영되는 또다른 상당한 척도이다.
Fig2(d)에서 두개의 peak을 볼 수 있다. 왼쪽 peak은 chaging 프로세스이고 오른쪽 peak은 방전 프로세스이다.
급속 충전 및 방전 과정에서 배터리 온도가 크게 상승합니다. 게다가 사이클 숫자가 증가할수록 두 온도 peak의 높이가 증가하고 peak에 빠르게 도달한다. 이는 전해질 전도도와 리튬 이온 확산 성의 감소로 인한 것입니다.

* Internal Resistance-related features
배터리 성능 저하는 IR의 증가와 꽤 관련 있다. fig2는 수명주기 차원에서 IR의 진화를 보여줍니다. 감소 추세는 초기주기에서 관찰 된 다음 이후주기에서 상승 추세를 볼 수 있습니다. 

### 3.1 Feature selection
위의 기준으로 42개의 feature를 뽑았지만 문제는 sample 사이즈가 적기 때문에 overfitting이 될 수 있다.
이러한 상황 때문에 최적의 feature subset를 생성하려면 전체 feature 세트에서 feature 선택을 수행해야합니다.
filter, wrapper, embedded 방법, 세가지 타입으로 분류할 수 있다.  예측 모델에 제공 할 저 차원 특성 하위 집합을 생성하기 위해 각 범주의 대표적인 방법을 조사합니다. PCA 사용

#### 3.1.1 filter method
feature 중요성을 측정하기 위해서 ranking 기술을 사용한다.
첫번째, 각 feture와 target(battery lifetime) 사이의 Pearson correlation coefficient가 계산되고 점수가 각 feature에 할당된다.
둘째, 낮은 순위의 기능을 필터링하기 위해 임계 값이 설정됩니다. 여기서 임계 값을 20으로 설정했습니다. 즉, Pearson 상관 관계 순위를 기반으로 상위 20 개 기능이 선택되어 ML 기반 수명 예측 모델에 제공됩니다.

#### 3.1.2 Wrapper method
미리정의된 ML 예측 모델에서 가장 뒤어난 성능을 보인 최적의 feature를 찾는다.
서치 알고리즘에서는 genetic 알고리즘 채택, GA는 검색 프로세스에 무작위성을 도입하여 글로벌 최적을 찾는 이점이 있습니다.
미리 정의 된 ML모델은 GBRT 모델을 사용, 
첫째, GA 알고리즘은 feature 공간을 검색하고 가능한 feature 하위 집합을 생성하는 데 사용됩니다.
그런 다음 선택한 feature의 품질이 여기에서 블랙 박스 역할을하는 GBRT 모델을 기반으로 평가됩니다. 
이 두 단계는 최상의 예측 성능을 얻을 때까지 반복적으로 수행됩니다.
#### 3.1.3 Embedded method
모델 학습 프로세스의 일부, 정규화
elastic net사용 
#### 3.1.4 PCA

### 3.2 ML based prediction
elastic net, GPR, SVM, RF, GBRT, and NN 

RMSE와 MAPE로 모델 성능 평가

## 4. Results and discussions
filter, wrapper, pca로 feature의 차원이 각 20, 12, 6 으로 축소 되었다.
filter와 PCA 메소드를 능가해서 wrapper,, embedded 메소드가 예측 성능을 향상 시켰다. 이 두 가지 방법은 ML 모델에 의존하기 때문에 더 나은 성능을 제공하므로 예측 모델에서 사용할 수있는 우수한 기능 하위 집합을 생성 할 수 있습니다. 
wrapper(GA + GBRT) 메소드가 배터리 수명을 예측하는데 가장 우수하다.
이를 바탕으로 12개 feature가 선택 됨.

이를 기반으로 6개의 머신러닝 모델을 적용 해 보니 NN이 가장 좋지 못한 결과를 냈다. -> 샘플 사이즈가 작아서   
**전체적으로 SVM이 가장 좋은 성능을 냈다.**

MIT work는 세가지 테스트 배치를 기반으로 세가지 subset으로 나눴다. training, primary testin, secondary testing    
이 데이터 분리에는 문제가 있다. 
첫째, 트레이닝 셋이 ML모델에 적용하기에는 너무 적고 overfitting을 쉽게 유발 할 수 있다.
둘째, 대부분의 훈련 샘플은 수명이 짧은 cell 샘플이지만 수명이 긴 샘플은 대부분 테스트 세트에 할당되므로 결과적으로 불균형 한 샘플 분포는 테스트 세트에서 수명이 긴 cell의 역학을 포착하지 못합니다.
때문에 3.3에서 설명된 20배 계층화 된 랜덤 샘플링 방법으로 데이터셋을 나눴다.
MIT 에서는 elastic net 예측 모델로 173 사이클이었지만 새로운 데이터 분리 방법으로 127 사이클로 줄였다.

-> wraper + SVM 의 결과가 가장 좋았다.


## 결론

* 문제 ? 
    배터리 수명을 예측하는 일은 몇가지 이유로 어렵고, data를 기반으로 예측 해 봤다.
* 해결방법 ?
    기존의 MIT와는 다르게 feature를 12개로 했고 데이터 분리를 20번 계층화된 랜덤 샘플링 방법으로 데이터 셋을 나눴다.
* 왜 중요? 
    모르겠다, 기존 방식과 다르게 feature를 분석하고 데이터셋을 나눠서 더 좋은 성능의 예측 모델을 개발 한 것 ???
    